import{sampleRUM,loadFooter,decorateButtons,decorateIcons,decorateSections,decorateBlocks,decorateTemplateAndTheme,waitForLCP,loadBlocks,toClassName,getMetadata,loadCSS,loadBlock,loadHeader,decorateBlock,buildBlock,readBlockConfig,toCamelCase,createOptimizedPicture}from"./lib-franklin.js";import{a,div,domEl,p}from"./dom-helpers.js";const TEMPLATE_LIST=["application-note","news","publication","blog","event","about-us","newsroom","landing-page"];window.hlx.templates.add(TEMPLATE_LIST.map((e=>`/templates/${e}`)));const LCP_BLOCKS=["hero","hero-advanced","featured-highlights"],SUPPORT_CHANNELS=["DISTRIBUTOR","INTEGRATOR","SALES","TECH"];window.hlx.RUM_GENERATION="molecular-devices";let STICKY_ELEMENTS,PREV_STICKY_ELEMENTS,LAST_SCROLL_POSITION=0,LAST_STACKED_HEIGHT=0;const mobileDevice=window.matchMedia("(max-width: 991px)");export function loadScript(e,t,a,o,n){let r=document.querySelector(`head > script[src="${e}"]`);if(n&&r&&(r.remove(),r=null),r)"function"==typeof t&&t("noop");else{const n=document.querySelector("head");r=document.createElement("script"),r.src=e,o&&(r.async=!0),a&&r.setAttribute("type",a),r.onload=t,n.append(r)}return r}export function summariseDescription(e,t){let a=e;if(a.length>t){a=a.substring(0,t);const e=a.lastIndexOf(" ");-1!==e&&(a=a.substring(0,e))}return`${a}â€¦`}function optimiseHeroBlock(e){const t=e.querySelectorAll(".hero, .hero-advanced");if(!t||0===t.length)return;const a=document.createElement("div");a.append(...t),e.prepend(a)}function decorateWaveSection(e){const t=createOptimizedPicture("/images/wave-footer-bg-top.png","wave",!1,[{media:"(min-width: 992px)",width:"1663"},{width:"900"}]);t.querySelector("img").setAttribute("width","1663"),t.querySelector("img").setAttribute("height","180");const a=document.querySelector(":scope.fragment > div, .page-tabs, .landing-page, .section.wave:last-of-type, .section:last-of-type div:first-of-type .fragment:only-child");a&&!a.querySelector("picture")&&a.appendChild(t),a||e.appendChild(div({class:"section wave","data-section-status":"initialized"},t))}function decorateEmbeddedBlocks(e){e.querySelectorAll("div.section > div").forEach(decorateBlock)}function createBreadcrumbsSpace(e){if("auto"===getMetadata("breadcrumbs")){const t=document.createElement("div");t.classList.add("breadcrumbs-wrapper"),e.querySelector(".section").prepend(t)}}async function loadBreadcrumbs(e){if("auto"===getMetadata("breadcrumbs")){const t=e.querySelector(".breadcrumbs-wrapper"),a=buildBlock("breadcrumbs","");t.append(a),decorateBlock(a),await loadBlock(a)}}export function isVideo(e){let t=!1;return["vids.moleculardevices.com","vidyard.com"].forEach((a=>{e.hostname.includes(a)&&(t=!0)})),t}export function embedVideo(e,t,a){const o=t.pathname.substring(t.pathname.lastIndexOf("/")+1).replace(".html",""),n=new IntersectionObserver((t=>{t.some((e=>e.isIntersecting))&&(n.disconnect(),loadScript("https://play.vidyard.com/embed/v4.js",null,null,null,!0),e.parentElement.innerHTML=`<img style="width: 100%; margin: auto; display: block;"\n      class="vidyard-player-embed"\n      src="https://play.vidyard.com/${o}.jpg"\n      data-uuid="${o}"\n      data-v="4"\n      data-width="${"lightbox"===a?"700":""}"\n      data-height="${"lightbox"===a?"394":""}"\n      data-autoplay="${"lightbox"===a?"1":"0"}"\n      data-type="${"lightbox"===a?"lightbox":"inline"}"/>`)}));n.observe(e.parentElement)}export function videoButton(e,t,a){const o=a.pathname.split("/").at(-1).trim(),n=div({id:"overlay"},div({class:"vidyard-player-embed","data-uuid":o,"dava-v":"4","data-type":"lightbox","data-autoplay":"2"}));e.prepend(n),t.addEventListener("click",(e=>{e.preventDefault(),loadScript("https://play.vidyard.com/embed/v4.js",(()=>{VidyardV4.api.getPlayersByUUID(o)[0].showLightbox()}))}))}export function decorateExternalLink(e){if(!e.href)return;const t=new URL(e.href);if(t.origin===window.location.origin||t.host.endsWith("moleculardevices.com")||["https://view.ceros.com","https://share.vidyard.com","https://main--moleculardevices--hlxsites.hlx.page","https://main--moleculardevices--hlxsites.hlx.live","http://molecular-devices.myshopify.com","http://moldev.com","http://go.pardot.com","http://pi.pardot.com","https://drift.me"].includes(t.origin)||!t.protocol.startsWith("http")||e.closest(".languages-dropdown")||e.querySelector(".icon"))return;const a=["STRONG","EM","SPAN","H2"];if(Array.from(e.children).filter((e=>!a.includes(e.tagName))).length>0)return;e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer");const o=e.querySelector("h2"),n=domEl("i",{class:"fa fa-external-link"});o?o.appendChild(n):e.appendChild(n)}export function decorateLinks(e){e.querySelectorAll("a").forEach((e=>{const t=new URL(e.href);if(isVideo(t)&&!e.closest(".block.hero-advanced")&&!e.closest(".block.hero")){const o=e.closest(".button-container");if(e.closest(".block.cards")||o&&o.querySelector("strong,em"))videoButton(e.closest("div"),e,t);else{const o=e.parentElement,n=e.closest(".block.vidyard")&&!e.closest(".block.vidyard").classList.contains("lightbox"),r="EM"===o.tagName||n?"inline":"lightbox",i=div({class:"video-wrapper"},div({class:"video-container"},a({href:e.href},e.textContent)));e.href!==e.textContent&&i.append(p({class:"video-title"},e.textContent)),o.innerHTML=i.outerHTML,embedVideo(o.querySelector("a"),t,r)}}t.pathname.startsWith("/quote-request")&&!t.searchParams.has("pid")&&getMetadata("family-id")&&(t.searchParams.append("pid",getMetadata("family-id")),e.href=t.toString()),t.pathname.endsWith(".pdf")&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")),decorateExternalLink(e)}))}function decorateParagraphs(e){[...e.querySelectorAll("p > picture")].forEach((e=>{e.parentElement.classList.add("picture")})),[...e.querySelectorAll("ol > li > em:only-child")].forEach((e=>{e.parentElement.parentElement.classList.add("text-caption")}))}function lazyLoadHiddenPageNavTabs(e,t){const a=window.location.hash,o=a?a.substring(1,a.length).toLowerCase():t;e.forEach((e=>{if(e.getAttribute("aria-labelledby")!==o){e.querySelectorAll(".block").forEach((e=>{e.setAttribute("data-block-status","loaded"),e.setAttribute("data-block-lazy-load",!0),e.parentElement.style.display="none"}));const t=t=>{t.querySelectorAll(".block[data-block-lazy-load]").forEach((async e=>{e.removeAttribute("data-block-lazy-load"),e.setAttribute("data-block-status","initialized"),await loadBlock(e),e.parentElement.style.display=""})),e.setAttribute("data-section-status","loaded")},a=new IntersectionObserver((o=>{o.some((e=>e.isIntersecting))&&(a.disconnect(),t(e))}));a.observe(e),setTimeout((()=>{a.disconnect(),t(e)}),3500)}}))}function decoratePageNav(e){const t=e.querySelector(".page-tabs");if(!t)return;const a=t.closest("div.section");let o=[...e.querySelectorAll("div.section")];o=o.slice(o.indexOf(a)+1);const n=o.filter((e=>e.hasAttribute("data-name")));if(n){let e=0;o.forEach((t=>{e<n.length&&(t.classList.add("tabs"),t.setAttribute("aria-labelledby",n[e].getAttribute("data-name")),t.hasAttribute("data-name")&&(e+=1))}))}lazyLoadHiddenPageNavTabs(o,n[0].getAttribute("data-name"))}function detectSidebar(e){const t=e.querySelector(".section.sidebar");if(t){e.classList.add("sidebar");const a=e.children.length-1;e.style=`grid-template-rows: repeat(${a}, auto);`;const o=t.getAttribute("data-start-sidebar-at-section");if(o&&Number.parseInt(o,10)){const e=Number.parseInt(o,10);t.style=`grid-row: ${e} / infinite;`}}}function decorateLinkedPictures(e){[...e.querySelectorAll("picture + br + a, picture + a")].forEach((e=>{const t=e.previousElementSibling;let a=t.previousElementSibling;"PICTURE"===t.tagName&&(a=t),e.textContent.includes(e.getAttribute("href"))&&(e.innerHTML="",e.className="",e.appendChild(a))}))}function addPageSchema(){if(document.querySelector('head > script[type="application/ld+json"]'))return;const e=getMetadata("template"),t=e?e.split(",").map((e=>e.trim())):[],a=window.location.pathname;if(["Product","Application","Category","homepage","Blog","Event","Application Note"].some((e=>-1!==t.indexOf(e)))||["/products"].includes(a))try{const t="https://www.moleculardevices.com/",o="https://www.moleculardevices.com/images/header-menus/logo.svg",n=document.querySelector("main h1"),r=n?n.textContent:getMetadata("og:title"),i=document.querySelector(".hero img"),c=i?i.src:getMetadata("thumbnail")||getMetadata("og:image")||o,s=new URL(c,t),l=getMetadata("keywords"),d=document.createElement("script");d.setAttribute("type","application/ld+json");const u={"@type":"ImageObject",representativeOfPage:"True",url:o},m=["http://www.linkedin.com/company/molecular-devices","https://www.facebook.com/MolecularDevices","http://www.youtube.com/user/MolecularDevicesInc","https://twitter.com/moldev"],p=getMetadata("event-start"),h=getMetadata("event-end"),g=getMetadata("event-address");let y=null;if("homepage"===e){const e="Molecular Devices";y={"@context":"https://schema.org","@graph":[{"@type":"Organization",additionalType:"Organization",description:getMetadata("description"),name:e,sameAs:[...m,"https://en.wikipedia.org/wiki/Molecular_Devices"],url:t,telephone:"+1 877-589-2214",logo:{"@type":"ImageObject",url:o},openingHoursSpecification:{"@type":"OpeningHoursSpecification",dayOfWeek:["Monday","Tuesday","Wednesday","Thursday","Friday"],opens:"08:00",closes:"17:00"}},{"@type":"WebSite",name:e,url:t,potentialAction:{"@type":"SearchAction","query-input":"required name=search_term_string",target:{"@type":"EntryPoint",urlTemplate:"https://www.moleculardevices.com/search-results#q={search_term_string}"}}}]}}"Application"===e&&(y={"@context":"https://schema.org","@graph":[{"@type":"TechArticle",headline:r,name:r,description:getMetadata("description"),about:l?l.split(",").map((e=>e.trim())):[],url:document.querySelector("link[rel='canonical']").href,image:{"@type":"ImageObject",representativeOfPage:"True",url:s},author:{"@type":"Organization",name:"Molecular Devices",url:t,sameAs:m,logo:u},publisher:{"@type":"Organization",name:"Molecular Devices",url:t,sameAs:m,logo:u}},{"@type":"ImageObject",name:r,url:s}]}),("Product"===e||e.includes("Category")||"/products"===a)&&(y={"@context":"https://schema.org","@graph":[{"@type":"WebPage",name:r,description:getMetadata("description"),url:document.querySelector("link[rel='canonical']").href,image:{"@type":"ImageObject",representativeOfPage:"True",url:s},author:{"@type":"Organization",name:"Molecular Devices",url:t,sameAs:m,logo:u}}]}),"Blog"===e&&(y={"@context":"https://schema.org","@graph":[{"@type":"BlogPosting",headline:r,name:r,description:getMetadata("description"),about:l?l.split(",").map((e=>e.trim())):[],image:{"@type":"ImageObject",representativeOfPage:"True",url:s},author:{"@type":"Organization",name:"Molecular Devices",url:document.querySelector("link[rel='canonical']").href,sameAs:m,logo:u}}]}),"Application Note"===e&&(y={"@context":"https://schema.org","@graph":[{"@type":"TechArticle",headline:r,name:r,description:getMetadata("description"),about:l?l.split(",").map((e=>e.trim())):[],author:{"@type":"Organization",name:"Molecular Devices",url:document.querySelector("link[rel='canonical']").href,sameAs:m,logo:u}}]}),"Event"===e&&(y={"@context":"https://schema.org","@graph":[{"@type":"Event",name:r,url:document.querySelector("link[rel='canonical']").href,description:getMetadata("description"),eventAttendanceMode:getMetadata("event-type"),startDate:p?p.split(",")[0]:"",endDate:h?h.split(",")[0]:"",image:{"@type":"ImageObject",representativeOfPage:"True",url:s},location:{"@type":"City",name:g?g.split(",").map((e=>e.trim())):[]}}]}),y&&(d.appendChild(document.createTextNode(JSON.stringify(y,null,2))),document.querySelector("head").appendChild(d))}catch(e){}}function addHreflangTags(){if(document.querySelectorAll("head link[hreflang]").length>0)return;const e=getMetadata("template"),t=e?e.split(",").map((e=>e.trim())):[],a=window.location.pathname;if(!["homepage","Product","Application","Category","Technology","Customer Breakthrough","Video Gallery","contact","About Us"].some((e=>-1!==t.indexOf(e)))&&!["/leadership","/products","/applications","/customer-breakthroughs"].includes(a))return;[{lang:"x-default",href:"https://www.moleculardevices.com"},{lang:"de",href:"https://de.moleculardevices.com"},{lang:"es",href:"https://es.moleculardevices.com"},{lang:"fr",href:"https://fr.moleculardevices.com"},{lang:"it",href:"https://it.moleculardevices.com"},{lang:"ko",href:"https://ko.moleculardevices.com"},{lang:"zh",href:"https://www.moleculardevices.com.cn"}].forEach((e=>{const t=document.createElement("link");t.setAttribute("rel","alternate"),t.setAttribute("hreflang",e.lang),t.setAttribute("href",e.href+a),document.querySelector("head").appendChild(t)}))}export async function decorateMain(e){decorateButtons(e),decorateIcons(e),optimiseHeroBlock(e),decorateSections(e),decorateWaveSection(e),decorateBlocks(e),decoratePageNav(e),detectSidebar(e),decorateLinkedPictures(e),decorateLinks(e),decorateParagraphs(e),addPageSchema(),addHreflangTags()}function isHomepage(){return"/"===window.location.pathname}async function loadEager(e){document.documentElement.lang=document.documentElement.lang||"en",document.documentElement.setAttribute("original-lang",document.documentElement.lang),isHomepage()||(document.originalTitle=document.title,document.title=`${document.title??""} | Molecular Devices`),decorateTemplateAndTheme();const t=e.querySelector("main");t&&(await window.hlx.plugins.run("loadEager"),await decorateMain(t),createBreadcrumbsSpace(t),await waitForLCP(LCP_BLOCKS)),window.innerWidth>=900&&loadCSS(`${window.hlx.codeBasePath}/styles/fonts.css`);try{sessionStorage.getItem("fonts-loaded")&&loadCSS(`${window.hlx.codeBasePath}/styles/fonts.css`)}catch(e){}}export function formatDate(e,t={}){if(!e)return"";const a=e.split(/[/,]/),o=new Date(a[2],a[0]-1,a[1]);return o?o.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric",...t}):e}export function formatDateUTCSeconds(e,t={}){const a=new Date(0);return a.setUTCSeconds(e),a.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric",...t})}export function unixDateToString(e){const t=new Date(1e3*e),a=t.getUTCDate();return`${(t.getMonth()+1).toString().padStart(2,"0")}/${a}/${t.getFullYear()}`}export function addLinkIcon(e){const t=document.createElement("i");t.className="fa fa-chevron-circle-right",t.ariaHidden=!0,e.append(t)}export async function fetchFragment(e,t=!0){const a=await fetch(e+(t?".plain.html":""));if(!a.ok)return null;const o=await a.text();return o||null}function getStickyElements(){PREV_STICKY_ELEMENTS=STICKY_ELEMENTS,STICKY_ELEMENTS=mobileDevice.matches?document.querySelectorAll(".sticky-element.sticky-mobile"):document.querySelectorAll(".sticky-element.sticky-desktop"),PREV_STICKY_ELEMENTS&&PREV_STICKY_ELEMENTS.forEach((e=>{let t=!1;STICKY_ELEMENTS.forEach((a=>{e===a&&(t=!0)})),t||(e.classList.remove("sticky"),e.style.top="")}))}function enableStickyElements(){getStickyElements(),mobileDevice.addEventListener("change",getStickyElements);const e=[];STICKY_ELEMENTS.forEach(((t,a)=>{e[a]=t.offsetTop})),window.addEventListener("scroll",(()=>{const t=window.pageYOffset;let a=0;STICKY_ELEMENTS.forEach(((o,n)=>{t>e[n]-a?document.querySelector('header .mainmenu-wrapper [aria-expanded="true"]')||(o.classList.add("sticky"),o.style.top=`${a}px`,a+=o.offsetHeight):(o.classList.remove("sticky"),o.style.top=""),t<LAST_SCROLL_POSITION&&t<=e[n]?o.style.top=`${Math.max(e[n]-t,a-o.offsetHeight)}px`:o.style.top=a-o.offsetHeight+"px"})),LAST_SCROLL_POSITION=t,a!==LAST_STACKED_HEIGHT&&(LAST_STACKED_HEIGHT=a,document.querySelector(":root").style.setProperty("--stacked-height",`${a}px`))}))}async function loadLazy(e){const t=e.querySelector("main");if(loadHeader(e.querySelector("header")),await loadBlocks(t),!window.location.pathname.startsWith("/cp-request")){enableStickyElements();const{hash:a}=window.location,o=!!a&&e.getElementById(a.substring(1));a&&o&&o.scrollIntoView(),loadFooter(e.querySelector("footer")),loadBreadcrumbs(t),loadCSS(`${window.hlx.codeBasePath}/styles/lazy-styles.css`),loadCSS(`${window.hlx.codeBasePath}/styles/fonts.css`).then((()=>{try{window.location.hostname.includes("localhost")||sessionStorage.setItem("fonts-loaded","true")}catch(e){}})),window.hlx.plugins.run("loadLazy"),sampleRUM("lazy"),sampleRUM.observe(t.querySelectorAll("div[data-block-name]")),sampleRUM.observe(t.querySelectorAll("picture > img"))}}function loadDelayed(){window.location.pathname.startsWith("/cp-request")||window.setTimeout((()=>(window.hlx.plugins.load("delayed"),window.hlx.plugins.run("loadDelayed"),import("./delayed.js"))),3e3)}export function getQueryParameter(){return new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)})}export function setCookie(e,t,a){const o=new Date;let n="",r="",i="";o.setTime(o.getTime()+24*a*60*60*1e3),0!==a&&(i=`expires=${o.toUTCString()}`),r=window.location.hostname.endsWith(".moleculardevices.com"),!0===r&&(n="domain=.moleculardevices.com;"),document.cookie=`${e}=${t};secure;${n}${i};path=/`}export function getCookie(e){const t=`${e}=`,a=decodeURIComponent(document.cookie).split(";");for(let e=0;e<a.length;e++){let o=a[e];for(;" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return""}function setCookieFromQueryParameters(e,t){const a=getQueryParameter();a[e]&&setCookie(e,a[e],t)}export function detectStore(){if(!localStorage.getItem("ipstack:geolocation"))return!1;try{return"US"===JSON.parse(localStorage.getItem("ipstack:geolocation")).country_code}catch(e){return!1}}export function getCartItemCount(){return getCookie("cart-item-count")||0}export function detectAnchor(e){const t=window.location.hash;if(!t)return;const a=t.substring(1,t.length).toLocaleLowerCase();if(e.querySelector(`#${a}`)){const t=new MutationObserver((a=>{a.forEach((a=>{"attributes"===a.type&&"data-block-status"===a.attributeName&&"loaded"===e.attributes.getNamedItem("data-block-status").value&&(t.disconnect(),setTimeout((()=>{window.dispatchEvent(new Event("hashchange"))}),3500))}))}));t.observe(e,{attributes:!0})}}async function loadPage(){await window.hlx.plugins.load("eager"),await loadEager(document),await window.hlx.plugins.load("lazy"),await loadLazy(document),loadDelayed()}const cookieParams=["cmp","utm_medium","utm_source","utm_keyword","gclid"];cookieParams.forEach((e=>{setCookieFromQueryParameters(e,0)}));export function isAuthorizedUser(){const e=getCookie("STYXKEY_PortalUserRole");return e&&SUPPORT_CHANNELS.includes(e)&&window.location.hostname.endsWith("moleculardevices.com")}export function isGatedResource(e){const t=isAuthorizedUser();return"Yes"===e.gated&&e.gatedURL&&"0"!==e.gatedURL&&(!t||e.gatedURL.includes("https://chat.moleculardevices.com"))}export function processSectionMetadata(e){const t=e.querySelector(".section-metadata");if(t){const a=readBlockConfig(t);Object.keys(a).forEach((t=>{"style"===t?e.classList.add(toClassName(a.style)):e.dataset[toCamelCase(t)]=a[t]})),t.remove()}}export async function processEmbedFragment(e){const t=div({class:"embed-fragment"});[...e.classList].forEach((e=>{t.classList.add(e)}));let a=!1;const o=e.querySelector("a");if(o){const e=new URL(o.href);let n;try{n=new URL(o.textContent)}catch{}if(n&&n.pathname===e.pathname){if(a=["localhost","moleculardevices.com","moleculardevices--hlxsites.hlx.page","moleculardevices--hlxsites.hlx.live"].find((t=>e.hostname.endsWith(t))),a){t.classList.remove("button-container");const a=await fetchFragment(e);t.innerHTML=a;[...t.querySelectorAll(".embed-fragment > div")].forEach((e=>{e.classList.add("section")})),decorateEmbeddedBlocks(t),decorateSections(t),loadBlocks(t)}}}if(!a){const a=e.innerHTML;t.append(div({class:"section"})),t.querySelector(".section").innerHTML=a}return decorateButtons(t),decorateIcons(t),decorateLinks(t),decorateParagraphs(t),t}loadPage();